<!-- src/app/layouts/admin-layout/pages/plans/plans.component.html -->
<div class="card p-3">
  <h5 class="mb-3">ุฅุฏุงุฑุฉ ุงูุฎุทุท ุงูุชุฏุฑูุจูุฉ</h5>

  <!-- ุงุฎุชูุงุฑ ุงููุชุฏุฑูุจ -->
  <div class="form-group mb-3">
    <label>ุงุฎุชุฑ ุงููุชุฏุฑูุจ</label>
    <select class="form-control" [(ngModel)]="selectedTraineeId" (change)="onSelectTrainee()">
      <option [ngValue]="null">-- ุงุฎุชุฑ -- (ุนุฑุถ ูู ุงูุฎุทุท)</option>
      <option *ngFor="let t of trainees" [ngValue]="t.id">
        {{ t.username }} ({{ t.first_name || '-' }} {{ t.last_name || '' }})
      </option>
    </select>
    <small class="text-muted d-block mt-1">
      ุนูุฏ ุงุฎุชูุงุฑ โ-- ุงุฎุชุฑ --โ ุณูุชู ุนุฑุถ ุฌููุน ุงูุฎุทุท ููู ุงููุชุฏุฑูุจูู.
    </small>
  </div>

  <!-- ุดุฑูุท ุฃุฏูุงุช: ุจุญุซ + ุฅุถุงูุฉ (ุฒุฑ ุงูุฅุถุงูุฉ ูุธูุฑ ููุท ูููุฏุฑูุจ) -->
  <div class="toolbar mb-3 d-flex gap-2 align-items-center">
    <input
      class="form-control grow"
      placeholder="ุงุจุญุซ ุจุงูุนููุงู..."
      [(ngModel)]="q"
      (ngModelChange)="onSearchChange()">

    <!-- โ ุฒุฑ ุฅุถุงูุฉ ุฎุทุฉ ุฌุฏูุฏุฉ ูุธูุฑ ููุท ุฅุฐุง ูุงู ุงูุฏูุฑ Trainer -->
    <button
      *ngIf="role === 'trainer'"
      class="btn btn-primary ms-auto"
      [disabled]="!selectedTraineeId"
      (click)="openAdd(addTpl)">
      + ุฅุถุงูุฉ ุฎุทุฉ ุฌุฏูุฏุฉ
    </button>
  </div>

  <!-- ุฌุฏูู -->
  <div class="table-responsive">
    <app-generic-table
      [cols]="cols"
      [rows]="viewPlans"
      [loading]="loadingPlans"
      [actionsTpl]="actions">
    </app-generic-table>
  </div>

  <!-- ุฅุฌุฑุงุกุงุช ุงูุตู -->
  <ng-template #actions let-row>
    <button class="btn btn-sm btn-info mr-2" (click)="openEdit(row, addTpl)" [disabled]="!selectedTraineeId">ุชุนุฏูู</button>
    <button class="btn btn-sm btn-danger" (click)="removePlan(row)" [disabled]="!selectedTraineeId">ุญุฐู</button>
  </ng-template>

  <div *ngIf="!loadingPlans && viewPlans.length === 0" class="text-muted mt-2">
    ูุง ุชูุฌุฏ ุฎุทุท ูุทุงุจูุฉ.
  </div>
</div>

<!-- Modal: ุฅุถุงูุฉ/ุชุนุฏูู ุฎุทุฉ -->
<ng-template #addTpl let-modal>
  <div class="modal-header">
    <h5 class="modal-title">{{ editMode ? 'ุชุนุฏูู ุงูุฎุทุฉ' : 'ุฅุถุงูุฉ ุฎุทุฉ ุฌุฏูุฏุฉ' }}</h5>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body">
    <div class="form-row">
      <div class="form-group col-md-6">
        <label>ุนููุงู ุงูุฎุทุฉ</label>
        <input class="form-control" [(ngModel)]="form.title" placeholder="ูุซูุงู: Upper/Lower split">
      </div>
      <div class="form-group col-md-6">
        <label>ุฃูุงู/ุฃุณุจูุน</label>
        <input type="number" class="form-control" [(ngModel)]="form.days_per_week" min="1" max="7">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group col-md-4">
        <label>Sets</label>
        <input type="number" class="form-control" [(ngModel)]="form.sets" min="1">
      </div>
      <div class="form-group col-md-4">
        <label>Reps</label>
        <input type="number" class="form-control" [(ngModel)]="form.reps" min="1">
      </div>
      <div class="form-group col-md-4">
        <label>ุงููุฏุฉ (ุฏูุงุฆู)</label>
        <input type="number" class="form-control" [(ngModel)]="form.duration_minutes" min="1">
      </div>
    </div>

    <!-- ุงููุตู -->
    <div class="form-group">
      <label>ุงููุตู (ุงุฎุชูุงุฑู)</label>
      <textarea class="form-control" rows="3"
                [(ngModel)]="form.description"
                placeholder="ููุงุญุธุงุช ูุฎุชุตุฑุฉ ุนู ุงูุฎุทุฉ..."></textarea>
    </div>

    <!-- ๐๏ธ ุงุฎุชูุงุฑ ุฃูุงู ุงูุฃุณุจูุน (0=ุงูุฃุญุฏ .. 6=ุงูุณุจุช) -->
    <div class="form-group">
      <label class="d-block mb-2">ุฃูุงู ุงูุฃุณุจูุน</label>
      <div class="row g-2">
        <div class="col-6 col-md-3" *ngFor="let d of weekDays">
          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   [id]="'dow_'+d.value"
                   [checked]="form.days.has(d.value)"
                   (change)="toggleDay(d.value, $event.target.checked)">
            <label class="form-check-label" [for]="'dow_'+d.value">
              {{ d.label }} ({{ d.value }})
            </label>
          </div>
        </div>
      </div>
      <small class="text-muted d-block mt-1">
        ุงูุชุฑููุฒ ูุทุงุจู ูู JavaScript: 0=Sunday .. 6=Saturday โ ููููุงุฑูุฉ ูุงุญููุง ูุน <code>new Date().getDay()</code>.
      </small>
    </div>

    <!-- ุงูุฃุฌูุฒุฉ -->
    <div class="mb-2">
      <label class="d-block">ุงูุฃุฌูุฒุฉ (Machines)</label>
      <div *ngIf="loadingMachines" class="text-muted">...ุชุญููู ุงูุฃุฌูุฒุฉ</div>
      <div class="row" *ngIf="!loadingMachines">
        <div class="col-md-6" *ngFor="let m of machines">
          <div class="form-check">
            <input class="form-check-input" type="checkbox"
                   [id]="'m'+m.id"
                   [checked]="form.machines.has(m.id)"
                   (change)="toggleMachine(m.id, $event.target.checked)">
            <label class="form-check-label" [for]="'m'+m.id">
              {{ m.name }}
            </label>
          </div>
        </div>
      </div>
      <div *ngIf="!loadingMachines && machines.length === 0" class="text-muted">
        ูุง ููุฌุฏ ุฃุฌูุฒุฉ ูุณุฌูุฉ.
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="modal.dismiss()">ุฅูุบุงุก</button>
    <button class="btn btn-primary" [disabled]="!form.title.trim()" (click)="savePlan()">
      ุญูุธ
    </button>
  </div>
</ng-template>
