<div class="card p-3">
  <h5 class="mb-3">إدارة الأجهزة (Machines)</h5>

  <div class="toolbar row g-2 mb-3">
    <div class="col-md-3">
      <input class="form-control" placeholder="بحث بالاسم/الكود/الشرح"
             [(ngModel)]="q" (ngModelChange)="load()">
    </div>
    <div class="col-md-3">
      <input type="number" class="form-control" placeholder="فلترة حسب ID"
             [(ngModel)]="idFilter" (ngModelChange)="load()">
    </div>
    <div class="col-md-3">
      <select class="form-control" [(ngModel)]="activeFilter" (change)="load()">
        <option value="all">الكل</option>
        <option value="active">Active فقط</option>
        <option value="inactive">Inactive فقط</option>
      </select>
    </div>
    <div class="col-md-3 text-end">
      <button class="btn btn-primary" (click)="openAdd(addTpl)">+ إضافة جهاز</button>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th *ngFor="let c of cols">{{ c.label }}</th>
          <th>إجراءات</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows">
          <td>{{ r.code }}</td>
          <td>{{ r.name }}</td>
          <td>{{ r.description || '-' }}</td>
          <td>
            <span class="badge" [class.bg-success]="r.is_active" [class.bg-secondary]="!r.is_active">
              {{ r.is_active ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td>
            <button class="btn btn-sm btn-info me-2" (click)="openEdit(r, addTpl)">تعديل</button>
            <button class="btn btn-sm btn-warning me-2" (click)="toggleActive(r)">
              تبديل الحالة
            </button>
            <button class="btn btn-sm btn-danger" (click)="remove(r)">حذف</button>
          </td>
        </tr>
        <tr *ngIf="!rows.length && !loading">
          <td colspan="5" class="text-muted text-center">لا توجد بيانات لعرضها</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="loading" class="text-muted">...تحميل</div>
</div>

<!-- Modal -->
<ng-template #addTpl let-modal>
  <div class="modal-header">
    <h5 class="modal-title">{{ editMode ? 'تعديل جهاز' : 'إضافة جهاز' }}</h5>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body">
    <div class="row g-3">
      <div class="col-md-4">
        <label>الكود</label>
        <input class="form-control" [(ngModel)]="form.code" maxlength="10" />
      </div>
      <div class="col-md-8">
        <label>الاسم</label>
        <input class="form-control" [(ngModel)]="form.name" maxlength="100" />
      </div>
      <div class="col-12">
        <label>الشرح</label>
        <textarea class="form-control" rows="3" [(ngModel)]="form.description"></textarea>
      </div>
      <div class="col-12">
        <div class="form-check mt-2">
          <input class="form-check-input" type="checkbox" id="active" [(ngModel)]="form.is_active">
          <label class="form-check-label" for="active">Active</label>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="modal.dismiss()">إلغاء</button>
    <button class="btn btn-primary" (click)="save()" [disabled]="saving || !form.code.trim() || !form.name.trim()">
      حفظ
    </button>
  </div>
</ng-template>
